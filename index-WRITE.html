<!DOCTYPE html>
<html>
<head>
  <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <meta name = "viewport" content="width=device-width, initial-scale=1">
  <link rel = "stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

  <!-- <script src = "index.js"></script> -->
  <link rel = "stylesheet" href="style.css">
  <!-- <script src = "googleApi.js"></script> -->


  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</head>

<body>
<button id="signin-button" onclick="handleSignInClick()">Sign in</button>
<button id="signout-button" onclick="handleSignOutClick()">Sign out</button>
<button id="save-button" onclick="handleSaveClick()">Save</button>

<ul>
<li><span id = "add-row" class="glyphicon glyphicon-plus"></span></li>
<li>Date</li>
<li>Name</li>
<li>Type</li>
<li>Cost</li>
</ul>

          <script>
          function makeApiCall(action = "read") {
            spreadsheetId: '1u78721qdi7iKUmJV7RvqNIJ6_mpKXPonJjv1S3BDn48';
            range: 'Sheet1';

            if (action == 'write'){
              var vals = new Array(6);
              for (var row = 0; row < 6; row++){
                vals[row] = new Array(4);
                for (var col = 0; col < 4; col++){
                  vals[row][col] = document.getElementById(row + ":" + col).value;
                }
              }
              var params = {
                spreadsheetId: '1u78721qdi7iKUmJV7RvqNIJ6_mpKXPonJjv1S3BDn48',  // TODO: Update placeholder value.
                range: 'Sheet1',  // TODO: Update placeholder value.
                valueInputOption : 'RAW'  // TODO: Update placeholder value.
              };
              //write code here
              var valueRangeBody = {"values": vals};
              var request = gapi.client.sheets.spreadsheets.values.update(params,valueRangeBody);
              request.then(function(response){
                console.log(response.result);
              }, function(reason){
                console.error('error: ' + reason.result.error.message);
              });
            }
            else {
              var params = {
                spreadsheetId: '1u78721qdi7iKUmJV7RvqNIJ6_mpKXPonJjv1S3BDn48',  // TODO: Update placeholder value.
                range: 'Sheet1',  // TODO: Update placeholder value.
            };
            var request = gapi.client.sheets.spreadsheets.values.get(params);
            request.then(function(response) {
              // TODO: Change code below to process the `response` object:
              //console.log(response.result);
              populateSheet(response.result);
            }, function(reason) {
              console.error('error: ' + reason.result.error.message);
            });
          }}

          function initClient() {
            var API_KEY = 'AIzaSyCIKSE_U4Xpx5AQ5Ve3HqmKvOHaz7_xQyk';  // TODO: Update placeholder with desired API key.

            var CLIENT_ID = '714430751953-5vul5f1cnm4i3ab1eho04fdu8tlq278j.apps.googleusercontent.com';  // TODO: Update placeholder with desired client ID.

            // TODO: Authorize using one of the following scopes:
            //   'https://www.googleapis.com/auth/drive'
            //   'https://www.googleapis.com/auth/drive.file'
            //   'https://www.googleapis.com/auth/drive.readonly'
            //   'https://www.googleapis.com/auth/spreadsheets'
            //   'https://www.googleapis.com/auth/spreadsheets.readonly'
            var SCOPE = 'https://www.googleapis.com/auth/spreadsheets';

            gapi.client.init({
              'apiKey': API_KEY,
              'clientId': CLIENT_ID,
              'scope': SCOPE,
              'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(function() {
              gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
              updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
          }

          function handleClientLoad() {
            gapi.load('client:auth2', initClient);
          }

          function updateSignInStatus(isSignedIn) {
            if (isSignedIn) {
              makeApiCall();
            }
          }

          function handleSignInClick(event) {
            gapi.auth2.getAuthInstance().signIn();
          }

          function handleSignOutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
            //console.log('signout')
          }

          function handleSaveClick() {
            makeApiCall(action="write");
          }

          // assign value from spreadsheet to each column and row to its value attribute

          function populateSheet(result){
            for (var row = 0; row < 8; row++){
              for (var col = 0; col < 4; col++){
                var dataFromSpreadSheet = result.values[row][col];
                console.log(dataFromSpreadSheet);
                document.getElementById(row + ':' +col).value = result.values[row][col];
                //$("input[value = "row + '+' + col"]").val(result.values[row][col]);
              }
            }
          }

          //add one row then plus btn clicked
            $(document).ready(function(){

              $(document).on('click','#add-row', function(){
                  var rowCounter = $('div').length;

                  var div = $('<div>',{
                  "id" : rowCounter
                  })
                  .css("clear", "both")
                  $('body').append(div)

                  var span = $('<span>',{
                    "id": "add-row",
                    "class": "glyphicon glyphicon-plus"
                  })
                  $(div).append(span)


                  for (var col = 0; col < 4; col++){
                    if (col == '0'){
                      var input = $('<input>',{
                        "class": "tableForSpreadsheet",
                        "type": "text",
                        "id": rowCounter + ':' + col + " datepick",
                        "value": rowCounter + ':' + col
                      })
                    }
                    else {
                      var input = $('<input>',{
                        "class": "tableForSpreadsheet",
                        "type": "text",
                        "id": rowCounter + ':' + col,
                        "value": rowCounter + ':' + col
                      })
                    }
                    input.css("float", "left");
                    div.append(input);
                  }
                  //add delete btn
                  var deleteBtn = $('<button>',{
                    "type": "button",
                    "id": "delete-row"
                  })
                  deleteBtn.text("DELETE");
                  div.append(deleteBtn);

                  div.insertAfter($(this).parents().closest('div'));

                  //display calendar when user input date       //not working
                  var pickDate = $("input[class = 'tableForSpreadsheet']");
                  $(document).on('focus', pickDate, function(){
                    console.log("you clicked input datepick")
                    //pickDate.css("border","1px solid black")
                    //pickDate.datepicker();
                  })

                  //delete one row when delete btn clicked       //not working
                  $(document).on('click', '#delete-row', function(){
                    $(this).closest('input').remove();
                  })

                  //calculate total cost for specific type

              })
            })

          </script>

</body>
</html>
